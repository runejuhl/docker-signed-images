#!/bin/bash
#
# Build a Docker image and sign it using GPG, adding the signature of the last
# intermediate layer to a new image. Using the new image it's possible to verify
# the author of a given Docker image without relying on external services.
#
# shellcheck disable=SC2222 disable=SC2221

set -euo pipefail

declare DOCKERFILE
declare CMD='docker build'

while [[ $# -gt 0 ]]; do
  case "$1" in
    *)
      CMD="${CMD} ${1}"
      shift
      if [[ $# -eq 0 ]]; then
        break
      fi
      CMD="${CMD} ${1}"
      ;;&
    -f|--file)
      DOCKERFILE="${1}"
      shift
      ;;
  esac

done

echo "Dockerfile is ${DOCKERFILE}"

# shellcheck disable=SC2086
eval $CMD
